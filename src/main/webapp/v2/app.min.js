(function(){var u=document.getElementById("canvasContainer");var h=document.getElementById("imageCanvas");var x=h.getContext("2d");var B=new Image();var l=new Image();var f={width:0,height:0};var m=1;var q=false;var k=false;var s=false;var z=false;var v=20;function c(F){var E=F.target;var D=new FileReader();D.onload=function(){B.src=D.result};D.readAsDataURL(E.files[0])}document.getElementById("canvas-file-input").addEventListener("change",c);B.onload=function(){j(this)};function j(K){u.style.display="none";m=1;document.getElementById("status--zoom").innerHTML="100%";document.getElementById("status--size").innerHTML=K.width+"&times;"+K.height;f.width=K.width;f.height=K.height;u.width=K.width;u.height=K.height;u.style.left=document.body.clientWidth/2-K.width/2;u.style.top=document.body.clientHeight/2-K.height/2;h.width=K.width;h.height=K.height;u.style.width=K.width;u.style.height=K.height;x.drawImage(K,0,0,K.width,K.height);imageData=x.getImageData(0,0,K.width,K.height);var I=new ArrayBuffer(imageData.data.length);var E=new Uint8ClampedArray(I);for(var H=0;H<imageData.data.length;H++){E[H]=imageData.data[H]}var J=new ArrayBuffer(imageData.data.length);var D=new Uint8ClampedArray(J);var G=new Uint32Array(J);for(var F=0;F<imageData.data.length;F++){D[F]=imageData.data[F]}o(G,K.width,K.height);w(D);l.src=h.toDataURL();w(E);A(u);document.getElementById("tools--tool--brush").classList.add("is-active");u.style.display="block"}document.getElementById("tools--tool--move").addEventListener("click",function(D){D.preventDefault();t(u,false);document.getElementById("tools--tool--zoom").classList.remove("is-active");A(u,false);document.getElementById("tools--tool--brush").classList.remove("is-active");z=false;document.getElementById("tools--tool--eraser").classList.remove("is-active");C(u);document.getElementById("tools--tool--move").classList.add("is-active")});document.getElementById("tools--tool--zoom").addEventListener("click",function(D){D.preventDefault();C(u,false);document.getElementById("tools--tool--move").classList.remove("is-active");A(u,false);document.getElementById("tools--tool--brush").classList.remove("is-active");z=false;document.getElementById("tools--tool--eraser").classList.remove("is-active");t(u);document.getElementById("tools--tool--zoom").classList.add("is-active")});document.getElementById("tools--tool--brush").addEventListener("click",function(D){D.preventDefault();C(u,false);document.getElementById("tools--tool--move").classList.remove("is-active");t(u,false);document.getElementById("tools--tool--zoom").classList.remove("is-active");z=false;document.getElementById("tools--tool--eraser").classList.remove("is-active");A(u);document.getElementById("tools--tool--brush").classList.add("is-active")});document.getElementById("tools--tool--eraser").addEventListener("click",function(D){D.preventDefault();C(u,false);document.getElementById("tools--tool--move").classList.remove("is-active");t(u,false);document.getElementById("tools--tool--zoom").classList.remove("is-active");document.getElementById("tools--tool--brush").classList.remove("is-active");A(u,true);z=true;document.getElementById("tools--tool--eraser").classList.add("is-active")});document.addEventListener("keydown",function(D){D.stopPropagation();if(D.code==="Space"){C(u);u.classList.remove("zoom")}if(D.code==="KeyY"){q=true;u.classList.add("zoom")}});document.addEventListener("keyup",function(D){if(D.code==="Space"){C(u,false)}if(D.code==="KeyY"){if(!k){document.getElementById("tools--tool--zoom").click()}k=false;q=false}if(D.code==="KeyM"){document.getElementById("tools--tool--move").click()}if(D.code==="KeyB"){document.getElementById("tools--tool--brush").click()}if(D.code==="KeyE"){document.getElementById("tools--tool--eraser").click()}});u.addEventListener("mousewheel",function(D){if(q){k=true;r(u,D.deltaY>0?"-":"+",D)}});u.addEventListener("mousemove",function(D){if(D.shiftKey&&this.getAttribute("data-is-zoomable")==="true"){this.classList.add("is-zoomable_out")}else{this.classList.remove("is-zoomable_out")}});var g=function(D){if(this.getAttribute("data-is-draggable")==="true"){return}r(this,D.shiftKey?"-":"+",D)};function t(D,E){var F=E!==false;if(D.getAttribute("data-is-zoomable")==="true"&&F){return D}if(F){D.addEventListener("click",g);D.setAttribute("data-is-zoomable",true);D.classList.add("is-zoomable")}else{D.removeEventListener("click",g);D.setAttribute("data-is-zoomable",false);D.classList.remove("is-zoomable")}return D}function r(G,J,D,I){var H=0.1;if(I===true){m=1}else{if(J==="-"){m-=H}else{m+=H}if(m<H){m=H}if(m>40){m=40}}var L=G.offsetWidth-f.width*m;var K=G.offsetHeight-f.height*m;var F=D.offsetX-D.offsetX*H;var E=D.offsetY-D.offsetY*H;G.style.width=f.width*m;G.style.height=f.height*m;G.style.left=n(G).left+L*(F/(f.width*m));G.style.top=n(G).top+K*(E/(f.height*m));document.getElementById("status--zoom").innerHTML=(m*100).toFixed(0)+"%"}var p=function(D){this.setAttribute("data-is-dragged",true);this.setAttribute("data-drag-offset-x",D.offsetX);this.setAttribute("data-drag-offset-y",D.offsetY)};var d=function(){this.setAttribute("data-is-dragged",false)};var y=function(D){if(this.getAttribute("data-is-dragged")==="true"){this.style.left=(D.clientX-this.getAttribute("data-drag-offset-x"))+"px";this.style.top=(D.clientY-this.getAttribute("data-drag-offset-y"))+"px"}};function C(D,E){var F=E!==false;if(D.getAttribute("data-is-draggable")==="true"&&F){return D}if(!F){D.setAttribute("data-is-draggable",false);D.setAttribute("data-is-dragged",false);D.classList.remove("is-draggable");D.removeEventListener("mousedown",p);D.removeEventListener("mouseup",d);D.removeEventListener("mouseout",d);D.removeEventListener("mousemove",y);return D}D.setAttribute("data-is-draggable",true);D.setAttribute("data-is-dragged",false);D.classList.add("is-draggable");D.addEventListener("mousedown",p);D.addEventListener("mouseup",d);D.addEventListener("mouseout",d);D.addEventListener("mousemove",y);return D}var a=function(){s=true};var i=function(){s=false};var b=function(E){if(!s){return}var D=E.offsetX;var F=E.offsetY;x.drawImage(E.shiftKey||z?B:l,D/m-v/2,F/m-v/2,v,v,D/m-v/2,F/m-v/2,v,v)};function A(D,E){var F=E!==false;if(D.getAttribute("data-is-brushable")==="true"&&F){return D}if(!F){D.setAttribute("data-is-brushable",false);D.classList.remove("is-brushable");h.removeEventListener("mousedown",a);h.removeEventListener("mouseup",i);h.removeEventListener("mousemove",b);return D}D.setAttribute("data-is-brushable",true);D.classList.add("is-brushable");h.addEventListener("mousedown",a);h.addEventListener("mouseup",i);h.addEventListener("mousemove",b);return D}function n(D){var E=D.getBoundingClientRect(),G=window.pageXOffset||document.documentElement.scrollLeft,F=window.pageYOffset||document.documentElement.scrollTop;return{top:E.top+F,left:E.left+G}}function e(E,D,G,F){return(E-D)*(E-D)+(G-F)*(G-F)}function o(W,R,N){var G=60;var U=R/G;var D=N/G;var I=[];var T=[];for(var J=0;J<G;J++){for(var K=0;K<G;K++){I[J*G+K]=Math.round(K*U+(Math.random()*U));T[J*G+K]=Math.round(J*D+(Math.random()*D))}}for(var Y=0;Y<N;Y++){for(var X=0;X<R;X++){var M=Math.round(Math.min(Math.floor(X/U),G-1));var L=Math.round(Math.min(Math.floor(Y/D),G-1));var E=L*G+M;var F=[E-G-1,E-G,E-G+1,E-1,E,E+1,E+G-1,E+G,E+G+1];var P=[];for(var V=0;V<F.length;V++){var H=F[V];if(H>=0&&H<=I.length-1){P.push(H)}}var Q=0;for(var S=0;S<P.length;S++){var O=P[S];if(e(I[O],X,T[O],Y)<e(I[Q],X,T[Q],Y)){Q=O}}W[Y*R+X]=W[T[Q]*R+I[Q]]}}}function w(D){imageData.data.set(D);x.putImageData(imageData,0,0)}})();