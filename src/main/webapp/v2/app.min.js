let $canvasContainer=document.getElementById("canvasContainer");let $canvas=document.getElementById("imageCanvas");let $ctx=$canvas.getContext("2d");let $originalImg=new Image();let $pixelatedImg=new Image();let originalImageDimensions={width:0,height:0};let tools=document.getElementById("tools");let brushOutline_canvas=document.getElementById("brushOutline");let brushOutline_ctx=brushOutline_canvas.getContext("2d");let brushOutline_setSize=function(a){let _size=a*zoomFactor;brushOutline_canvas.width=_size;brushOutline_canvas.height=_size;brushOutline_ctx.strokeStyle="rgb(0,0,0)";brushOutline_ctx.beginPath();brushOutline_ctx.arc(_size/2,_size/2,_size/2,0,Math.PI*2,true);brushOutline_ctx.stroke()};let zoomFactor=1;let mouseZoom=false;let wheelZoomDone=false;let isBrushing=false;let wasBrushing=false;let isErasing=false;let brushSize=100;brushOutline_setSize(brushSize);let toolSettings=document.getElementById("tool-settings");let toolSettingsRail=document.getElementById("tool-settings-rail");let toolSettingsKnob=document.getElementById("tool-settings-knob");let toolSettingsLabel=document.getElementById("tool-settings-label");let toolSettingsCallback=function(a){};let documentTouched=false;document.addEventListener("touchstart",function(){documentTouched=true});document.addEventListener("touchend",function(){documentTouched=false});function onTouchDrag(b,a){const c=5;let eventCount=0;b.addEventListener("touchstart",function(d){eventCount=0});b.addEventListener("touchmove",function(d){eventCount++;if(d.touches.length!==1){eventCount=0}if(eventCount<c){return}if(d.touches.length===1){let relativeX=d.touches[0].pageX-offset(b).left;let relativeY=d.touches[0].pageY-offset(b).top;a({x:relativeX,y:relativeY})}})}function onTwoFingerDrag(b,a){let previousCoordinates=null;b.addEventListener("touchmove",function(c){if(c.touches.length===2){let absoluteX=(Math.max(c.touches[0].pageX,c.touches[1].pageX)-Math.min(c.touches[0].pageX,c.touches[1].pageX))/2+Math.min(c.touches[0].pageX,c.touches[1].pageX);let absoluteY=(Math.max(c.touches[0].pageY,c.touches[1].pageY)-Math.min(c.touches[0].pageY,c.touches[1].pageY))/2+Math.min(c.touches[0].pageY,c.touches[1].pageY);let deltaX=previousCoordinates.x-absoluteX;let deltaY=previousCoordinates.y-absoluteY;previousCoordinates={x:absoluteX,y:absoluteY};a({dx:deltaX,dy:deltaY})}});b.addEventListener("touchstart",function(c){if(c.touches.length===2){previousCoordinates={x:(Math.max(c.touches[0].pageX,c.touches[1].pageX)-Math.min(c.touches[0].pageX,c.touches[1].pageX))/2+Math.min(c.touches[0].pageX,c.touches[1].pageX),y:(Math.max(c.touches[0].pageY,c.touches[1].pageY)-Math.min(c.touches[0].pageY,c.touches[1].pageY))/2+Math.min(c.touches[0].pageY,c.touches[1].pageY)}}});b.addEventListener("touchend",function(c){if(c.touches.length===2){previousCoordinates=null}})}function onPinch(a,b){let initialPinchDistance=null;a.addEventListener("touchstart",function(c){if(c.touches.length===2){let deltas=getDeltas(c);initialPinchDistance={dx:deltas.dx,dy:deltas.dy}}});a.addEventListener("touchend",function(c){initialPinchDistance=null});a.addEventListener("touchmove",function(c){let pinchThreshold=4.5;if(c.touches.length===2&&initialPinchDistance!==null){let deltas=getDeltas(c);let deltaDx=initialPinchDistance.dx>deltas.dx?initialPinchDistance.dx-deltas.dx:deltas.dx-initialPinchDistance.dx;let deltaDy=initialPinchDistance.dy>deltas.dy?initialPinchDistance.dy-deltas.dy:deltas.dy-initialPinchDistance.dy;let delta=Math.sqrt(deltaDx+deltaDy);if(deltas.dx<initialPinchDistance.dx){delta=-delta}if(delta<pinchThreshold&&delta>-pinchThreshold){return}initialPinchDistance=getDeltas(c);let absoluteX=(c.touches[0].pageX>c.touches[1].pageX?c.touches[0].pageX-c.touches[1].pageX:c.touches[1].pageX-c.touches[0].pageX)/2;let absoluteY=(c.touches[0].pageY>c.touches[1].pageY?c.touches[0].pageY-c.touches[1].pageY:c.touches[1].pageY-c.touches[0].pageY)/2;let relativeX=absoluteX-offset(this).left;let relativeY=absoluteY-offset(this).top;b({delta:delta,pageX:absoluteX,pageY:absoluteY,elementX:relativeX,elementY:relativeY})}})}function getDeltas(a){let x1=a.touches[0].pageX;let y1=a.touches[0].pageY;let x2=a.touches[1].pageX;let y2=a.touches[1].pageY;let dx=(x1>x2)?x1-x2:x2-x1;let dy=(y1>y2)?y1-y2:y2-y1;return{dx:dx,dy:dy}}function offset(a){let rect=a.getBoundingClientRect(),scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,scrollTop=window.pageYOffset||document.documentElement.scrollTop;return{top:rect.top+scrollTop,left:rect.left+scrollLeft}}function distSq(b,a,d,c){return(b-a)*(b-a)+(d-c)*(d-c)}document.getElementById("canvas-file-input").addEventListener("change",function(a){closeAllMenus();loadImage()});function loadImage(){let maxSizeWidth=1920;let maxSizeHeight=1920;$canvasContainer.style.display="none";showProgress("Opening image...",0);let imageData=null;let crystalImageData=null;showProgress("Loading file...",0.2);let file=URL.createObjectURL(document.getElementById("canvas-file-input").files[0]);let image=new Image();image.onload=function(){URL.revokeObjectURL(file);let canvas=document.createElement("canvas");let ctx=canvas.getContext("2d");canvas.width=image.width;canvas.height=image.height;ctx.drawImage(image,0,0,image.width,image.height);imageData=ctx.getImageData(0,0,image.width,image.height)};image.onerror=function(a){console.log(a)};showProgress("Loading image...",0.4);image.src=file;let awaitImageResize=setInterval(function(){if(imageData!==null){clearInterval(awaitImageResize);let canvas=document.createElement("canvas");let ctx=canvas.getContext("2d");let blobURL=null;let w=imageData.width;let h=imageData.height;canvas.width=w;canvas.height=h;ctx.putImageData(imageData,0,0);let image=new Image();image.onload=function(){URL.revokeObjectURL(blobURL);if(w>maxSizeWidth||h>maxSizeHeight){let percent;if(w>h){percent=maxSizeWidth/w}else{percent=maxSizeHeight/h}w=w*percent;h=h*percent}canvas.width=w;canvas.height=h;ctx.drawImage(image,0,0,imageData.width,imageData.height,0,0,w,h);imageData=ctx.getImageData(0,0,w,h);zoomFactor=1;document.getElementById("status--zoom").innerHTML="100%";document.getElementById("status--size").innerHTML=imageData.width+"&times;"+imageData.height;originalImageDimensions.width=imageData.width;originalImageDimensions.height=imageData.height;$canvasContainer.width=imageData.width;$canvasContainer.height=imageData.height;$canvasContainer.style.left=document.body.clientWidth/2-imageData.width/2+"px";$canvasContainer.style.top=document.body.clientHeight/2-imageData.height/2+"px";$canvasContainer.style.width=imageData.width+"px";$canvasContainer.style.height=imageData.height+"px";showProgress("Crystallizing image...",0.7)};canvas.toBlob(function(a){showProgress("Resizing image...",0.5);blobURL=URL.createObjectURL(a);image.src=blobURL})}},100);let awaitImageDraw1=setInterval(function(){if(imageData!==null&&imageData.width<=maxSizeWidth&&imageData.height<=maxSizeHeight){clearInterval(awaitImageDraw1);drawImage($originalImg,imageData,function(){$canvas.width=imageData.width;$canvas.height=imageData.height;$ctx.drawImage($originalImg,0,0)})}},100);let awaitImageDraw2=setInterval(function(){if(imageData!==null&&imageData.width<=maxSizeWidth&&imageData.height<=maxSizeHeight){clearInterval(awaitImageDraw2);crystalImageData=crystallize(imageData);showProgress("Image crystallized...",0.8)}},100);let awaitCrystallization=setInterval(function(){if(crystalImageData!==null){clearInterval(awaitCrystallization);drawImage($pixelatedImg,crystalImageData);showProgress("Done...",1);$canvasContainer.style.left=((document.width/2)-($canvasContainer.width/2))+"px";$canvasContainer.style.top=((document.height/2)-($canvasContainer.height/2))+"px";$canvasContainer.style.display="block";tools.style.display="block";setBrushable($canvasContainer);document.getElementById("tools--tool--brush").classList.add("is-active");document.getElementById("menu--file--save").classList.remove("menus--items--item--submenu--item_disabled")}},100)}function drawImage(a,b,c){let canvas=document.createElement("canvas");let context=canvas.getContext("2d");canvas.width=b.width;canvas.height=b.height;context.putImageData(b,0,0);canvas.toBlob(function(d){let blobURL=URL.createObjectURL(d);a.onload=function(){URL.revokeObjectURL(blobURL);if(typeof c==="function"){c()}};a.src=blobURL})}let menuIsOpen=false;let menuItems=document.querySelectorAll(".menus--items--item");let submenus=document.querySelectorAll(".menus--items--item--submenu");function closeAllMenus(){for(let i=0;i<submenus.length;i++){submenus[i].style.display="none"}}for(let i=0;i<menuItems.length;i++){let menuItem=menuItems[i];menuItem.addEventListener("click",function(a){a.stopPropagation();if(this.querySelector(".menus--items--item--submenu").style.display==="block"){this.querySelector(".menus--items--item--submenu").style.display="none";menuIsOpen=false}else{closeAllMenus();this.querySelector(".menus--items--item--submenu").style.display="block";menuIsOpen=true}});menuItem.addEventListener("mouseenter",function(){if(!menuIsOpen){return}if(this.querySelector(".menus--items--item--submenu").style.display!=="block"){closeAllMenus();this.querySelector(".menus--items--item--submenu").style.display="block"}})}document.addEventListener("click",function(){closeAllMenus();menuIsOpen=false});document.getElementById("menu-open").addEventListener("touchend",function(){document.querySelector(".menus").classList.add("menus_is-active")});document.getElementById("menu-close").addEventListener("touchend",function(a){a.preventDefault();document.querySelector(".menus").classList.remove("menus_is-active")});document.getElementById("menu--file--open").addEventListener("click",function(){closeAllMenus();document.getElementById("canvas-file-input").click()});document.getElementById("menu--file--save").addEventListener("click",function(){if(this.classList.contains("menus--items--item--submenu--item_disabled")){return}closeAllMenus();let $download=document.createElement("a");$download.setAttribute("href",$canvas.toDataURL("image/jpeg",0.8));$download.setAttribute("target","_blank");$download.setAttribute("download","anonymous-image.jpg");$download.click()});let progress=document.querySelector(".progress");function showProgress(b,a){console.log(b+" ("+(a*100).toFixed(0)+"%)");if(a===0){progress.style.display="block";progress.classList.remove("progress_hidden")}progress.querySelector(".progress--message").innerHTML=b;progress.querySelector(".progress--bar-container--bar").style.width=(a*100).toFixed(0)+"%";if(a===1){progress.classList.add("progress_hidden");setTimeout(function(){progress.style.display="none"},600)}}document.addEventListener("keydown",function(a){a.stopPropagation();if(a.code==="Space"){if($canvasContainer.getAttribute("data-is-brushable")==="true"){setBrushable($canvasContainer,false);wasBrushing=true}setDraggable($canvasContainer);$canvasContainer.classList.remove("zoom")}if(a.code==="KeyY"){mouseZoom=true;$canvasContainer.classList.add("zoom")}});document.addEventListener("keyup",function(a){if(a.code==="Space"){setDraggable($canvasContainer,false);if(wasBrushing){wasBrushing=false;setBrushable($canvasContainer)}}if(a.code==="KeyY"){if(!wheelZoomDone){document.getElementById("tools--tool--zoom").click()}wheelZoomDone=false;mouseZoom=false}if(a.code==="KeyM"){document.getElementById("tools--tool--move").click()}if(a.code==="KeyB"){document.getElementById("tools--tool--brush").click()}if(a.code==="KeyE"){document.getElementById("tools--tool--eraser").click()}});$canvasContainer.addEventListener("mousewheel",function(a){if(mouseZoom){wheelZoomDone=true;changeZoom($canvasContainer,a.deltaY>0?"-":"+",a.offsetX,a.offsetY)}});$canvasContainer.addEventListener("mousemove",function(a){if(a.shiftKey&&this.getAttribute("data-is-zoomable")==="true"){this.classList.add("is-zoomable_out")}else{this.classList.remove("is-zoomable_out")}});document.getElementById("tools--tool--move").addEventListener("click",function(a){a.preventDefault();setZoomable($canvasContainer,false);document.getElementById("tools--tool--zoom").classList.remove("is-active");setBrushable($canvasContainer,false);document.getElementById("tools--tool--brush").classList.remove("is-active");isErasing=false;document.getElementById("tools--tool--eraser").classList.remove("is-active");setDraggable($canvasContainer);document.getElementById("tools--tool--move").classList.add("is-active");document.getElementById("tools--tool--brush-size").classList.remove("is-active")});document.getElementById("tools--tool--zoom").addEventListener("click",function(a){a.preventDefault();setDraggable($canvasContainer,false);document.getElementById("tools--tool--move").classList.remove("is-active");setBrushable($canvasContainer,false);document.getElementById("tools--tool--brush").classList.remove("is-active");isErasing=false;document.getElementById("tools--tool--eraser").classList.remove("is-active");setZoomable($canvasContainer);document.getElementById("tools--tool--zoom").classList.add("is-active");document.getElementById("tools--tool--brush-size").classList.remove("is-active")});document.getElementById("tools--tool--brush").addEventListener("click",function(a){a.preventDefault();setDraggable($canvasContainer,false);document.getElementById("tools--tool--move").classList.remove("is-active");setZoomable($canvasContainer,false);document.getElementById("tools--tool--zoom").classList.remove("is-active");isErasing=false;document.getElementById("tools--tool--eraser").classList.remove("is-active");setBrushable($canvasContainer);document.getElementById("tools--tool--brush").classList.add("is-active");document.getElementById("tools--tool--brush-size").classList.remove("is-active")});document.getElementById("tools--tool--eraser").addEventListener("click",function(a){a.preventDefault();setDraggable($canvasContainer,false);document.getElementById("tools--tool--move").classList.remove("is-active");setZoomable($canvasContainer,false);document.getElementById("tools--tool--zoom").classList.remove("is-active");document.getElementById("tools--tool--brush").classList.remove("is-active");setBrushable($canvasContainer,true);isErasing=true;document.getElementById("tools--tool--eraser").classList.add("is-active");document.getElementById("tools--tool--brush-size").classList.remove("is-active")});document.getElementById("tools--tool--brush-size").addEventListener("click",function(a){a.preventDefault();a.stopPropagation();toolSettings.style.top="unset";toolSettings.style.left="50%";toolSettings.style.bottom="40px";toolSettings.style.display="block";document.getElementById("tools--tool--brush-size").classList.add("is-active");toolSettings.setAttribute("data-tool","brush");setDraggable($canvasContainer,false);document.getElementById("tools--tool--move").classList.remove("is-active");setZoomable($canvasContainer,false);document.getElementById("tools--tool--zoom").classList.remove("is-active");document.getElementById("tools--tool--brush").classList.remove("is-active");setBrushable($canvasContainer,false);isErasing=false;document.getElementById("tools--tool--eraser").classList.remove("is-active")});function crystallize(a){return filter(a,function(c,d,b){let cells=60;let cellWidth=d/cells;let cellHeight=b/cells;let xs=[];let ys=[];for(let y=0;y<cells;y++){for(let x=0;x<cells;x++){xs[y*cells+x]=Math.round(x*cellWidth+(Math.random()*cellWidth));ys[y*cells+x]=Math.round(y*cellHeight+(Math.random()*cellHeight))}}for(let y=0;y<b;y++){for(let x=0;x<d;x++){let currentCellX=Math.round(Math.min(Math.floor(x/cellWidth),cells-1));let currentCellY=Math.round(Math.min(Math.floor(y/cellHeight),cells-1));let nearestPoint=currentCellY*cells+currentCellX;let displacements=[nearestPoint-cells-1,nearestPoint-cells,nearestPoint-cells+1,nearestPoint-1,nearestPoint,nearestPoint+1,nearestPoint+cells-1,nearestPoint+cells,nearestPoint+cells+1];let adjacentPoints=[];for(let i=0;i<displacements.length;i++){let it=displacements[i];if(it>=0&&it<=xs.length-1){adjacentPoints.push(it)}}let n=0;for(let j=0;j<adjacentPoints.length;j++){let jt=adjacentPoints[j];if(distSq(xs[jt],x,ys[jt],y)<distSq(xs[n],x,ys[n],y)){n=jt}}c[y*d+x]=c[ys[n]*d+xs[n]]}}})}function filter(b,a){let _imageData=new ImageData(new Uint8ClampedArray(b.data),b.width,b.height);let buf=_imageData.data.buffer;let buf32=new Uint32Array(buf);a(buf32,_imageData.width,_imageData.height);return _imageData}onTouchDrag($canvasContainer,function(a){$ctx.save();$ctx.beginPath();$ctx.arc(a.x/zoomFactor,a.y/zoomFactor,brushSize/2,0,Math.PI*2);$ctx.closePath();$ctx.clip();$ctx.drawImage(isErasing?$originalImg:$pixelatedImg,a.x/zoomFactor-brushSize/2,a.y/zoomFactor-brushSize/2,brushSize,brushSize,a.x/zoomFactor-brushSize/2,a.y/zoomFactor-brushSize/2,brushSize,brushSize);$ctx.restore()});let startBrush=function(){isBrushing=true};let stopBrush=function(){isBrushing=false};let doBrush=function(a){if(documentTouched){return}let x=a.offsetX;let y=a.offsetY;brushOutline_canvas.style.display="block";brushOutline_canvas.style.left=(x-brushSize*zoomFactor/2)+"px";brushOutline_canvas.style.top=(y-brushSize*zoomFactor/2)+"px";if(!isBrushing&&a.type!=="click"){return}$ctx.save();$ctx.beginPath();$ctx.arc(x/zoomFactor,y/zoomFactor,brushSize/2,0,Math.PI*2);$ctx.closePath();$ctx.clip();$ctx.drawImage(a.shiftKey||isErasing?$originalImg:$pixelatedImg,x/zoomFactor-brushSize/2,y/zoomFactor-brushSize/2,brushSize,brushSize,x/zoomFactor-brushSize/2,y/zoomFactor-brushSize/2,brushSize,brushSize);$ctx.restore()};let brushLeaves=function(a){brushOutline_canvas.style.display="none"};function setBrushable(a,b){let _activate=b!==false;if(a.getAttribute("data-is-brushable")==="true"&&_activate){return a}if(!_activate){a.setAttribute("data-is-brushable",false);a.classList.remove("is-brushable");$canvas.removeEventListener("mousedown",startBrush);$canvas.removeEventListener("mouseup",stopBrush);$canvas.removeEventListener("mousemove",doBrush);$canvas.removeEventListener("click",doBrush);$canvas.removeEventListener("mouseleave",brushLeaves);brushOutline_canvas.style.display="none";return a}a.setAttribute("data-is-brushable",true);a.classList.add("is-brushable");$canvas.addEventListener("mousedown",startBrush);$canvas.addEventListener("mouseup",stopBrush);$canvas.addEventListener("mousemove",doBrush);$canvas.addEventListener("click",doBrush);$canvas.addEventListener("mouseleave",brushLeaves);toolSettings.setAttribute("data-tool","brush");return a}function setBrushSize(a){brushSize=a;brushOutline_setSize(a)}onTwoFingerDrag($canvasContainer,function(a){$canvasContainer.style.left=offset($canvasContainer).left-a.dx+"px";$canvasContainer.style.top=offset($canvasContainer).top-a.dy+"px"});let activateDrag=function(a){this.setAttribute("data-is-dragged",true);this.setAttribute("data-drag-offset-x",a.offsetX);this.setAttribute("data-drag-offset-y",a.offsetY)};let deactivateDrag=function(){this.setAttribute("data-is-dragged",false)};let doDrag=function(a){if(this.getAttribute("data-is-dragged")==="true"){this.style.left=(a.clientX-this.getAttribute("data-drag-offset-x"))+"px";this.style.top=(a.clientY-this.getAttribute("data-drag-offset-y"))+"px"}};function setDraggable(a,b){let _activate=b!==false;if(a.getAttribute("data-is-draggable")==="true"&&_activate){return a}if(!_activate){a.setAttribute("data-is-draggable",false);a.setAttribute("data-is-dragged",false);a.classList.remove("is-draggable");a.removeEventListener("mousedown",activateDrag);a.removeEventListener("mouseup",deactivateDrag);a.removeEventListener("mouseout",deactivateDrag);a.removeEventListener("mousemove",doDrag);return a}a.setAttribute("data-is-draggable",true);a.setAttribute("data-is-dragged",false);a.classList.add("is-draggable");a.addEventListener("mousedown",activateDrag);a.addEventListener("mouseup",deactivateDrag);a.addEventListener("mouseout",deactivateDrag);a.addEventListener("mousemove",doDrag);toolSettings.setAttribute("data-tool","none");return a}document.addEventListener("contextmenu",function(a){a.preventDefault();if(documentTouched){return}if(toolSettings.getAttribute("data-tool")==="none"){return}if(toolSettings.getAttribute("data-tool")==="brush"){toolSettingsCallback=function(){setBrushSize(toolSettings.getAttribute("data-value-log"));brushOutline_canvas.style.left=a.offsetX-brushSize*zoomFactor/2+"px";brushOutline_canvas.style.top=a.offsetY-brushSize*zoomFactor/2+"px"}}if(toolSettings.getAttribute("data-tool")==="zoom"){}toolSettings.style.left=a.clientX+"px";toolSettings.style.top=a.clientY+"px";toolSettings.style.display="block"});document.addEventListener("click",function(){toolSettings.style.display="none"});toolSettingsKnob.addEventListener("touchstart",function(a){if(toolSettings.getAttribute("data-tool")==="none"){return}if(toolSettings.getAttribute("data-tool")==="brush"){toolSettingsCallback=function(){setBrushSize(toolSettings.getAttribute("data-value-log"));brushOutline_canvas.style.left=a.touches[0].offsetX-brushSize*zoomFactor/2+"px";brushOutline_canvas.style.top=a.touches[0].offsetY-brushSize*zoomFactor/2+"px"}}document.addEventListener("touchmove",moveToolSettingsKnob);document.addEventListener("touchend",unmoveToolSettingsKnob);toolSettingsLabel.style.display="block"});toolSettingsKnob.addEventListener("mousedown",function(){document.addEventListener("mousemove",moveToolSettingsKnob);document.addEventListener("mouseup",unmoveToolSettingsKnob);toolSettingsLabel.style.display="block"});function unmoveToolSettingsKnob(){document.removeEventListener("mousemove",moveToolSettingsKnob);document.removeEventListener("mouseup",unmoveToolSettingsKnob);document.removeEventListener("touchmove",unmoveToolSettingsKnob);document.removeEventListener("touchend",unmoveToolSettingsKnob);toolSettingsLabel.style.display="none";toolSettings.style.display="none";toolSettingsCallback()}function moveToolSettingsKnob(a){let clientX=a.clientX||a.touches[0].clientX;let settingsOffset=offset(toolSettingsRail).left;let settingsMinPx=0-(toolSettingsKnob.clientWidth/2);let settingsMaxPx=toolSettingsRail.clientWidth-(toolSettingsKnob.clientWidth/2);let newSettingsPositionPx=clientX-settingsOffset-(toolSettingsKnob.clientWidth/2);if(newSettingsPositionPx<settingsMinPx){newSettingsPositionPx=settingsMinPx}if(newSettingsPositionPx>settingsMaxPx){newSettingsPositionPx=settingsMaxPx}let settingsPercent=(newSettingsPositionPx+(toolSettingsKnob.clientWidth/2))/(settingsMaxPx+(toolSettingsKnob.clientWidth/2));let settingsLog=getLogValues(settingsPercent,1,3000);toolSettingsKnob.style.left=newSettingsPositionPx+"px";if(toolSettings.getAttribute("data-label-mode")==="%"){toolSettingsLabel.innerHTML=(settingsPercent*100).toFixed(0)+" %"}else{if(toolSettings.getAttribute("data-label-mode")==="log"){toolSettingsLabel.innerHTML=settingsLog.toFixed(0)+" px"}else{toolSettingsLabel.innerHTML=settingsPercent.toFixed(2)}}toolSettings.setAttribute("data-value-percent",(settingsPercent*100).toFixed(2));toolSettings.setAttribute("data-value-log",settingsLog.toFixed(2))}function getLogValues(b,c,a){let minP=0;let maxP=100;let minV=Math.log(c);let maxV=Math.log(a);let scale=(maxV-minV)/(maxP-minP);return Math.exp(minV+scale*(b*100-minP))}const clickZoomChange=0.1;let zoomClickHelper=function(a){if(this.getAttribute("data-is-draggable")==="true"){return}changeZoom(this,a.pageX,a.pageY,a.layerX,a.layerY,a.shiftKey?-clickZoomChange:clickZoomChange)};onPinch($canvasContainer,function(a){let delta=0;if(a.delta>0){delta=0.02}if(a.delta<0){delta=-0.02}changeZoom($canvasContainer,a.pageX,a.pageY,a.elementX,a.elementY,delta)});function setZoomable(a,b){let _activate=b!==false;if(a.getAttribute("data-is-zoomable")==="true"&&_activate){return a}if(_activate){a.addEventListener("click",zoomClickHelper);a.setAttribute("data-is-zoomable",true);a.classList.add("is-zoomable");toolSettings.setAttribute("data-tool","zoom")}else{a.removeEventListener("click",zoomClickHelper);a.setAttribute("data-is-zoomable",false);a.classList.remove("is-zoomable")}return a}function changeZoom(e,a,g,c,b,d,f){if(f){zoomFactor=d}else{zoomFactor=zoomFactor+d}if(zoomFactor<0.1){zoomFactor=0.1}if(zoomFactor>40){zoomFactor=40}let width=$originalImg.width;let newWidth=width*zoomFactor;let originalCursorX=c/zoomFactor;let originalCursorY=b/zoomFactor;$canvasContainer.style.left=(a-c-originalCursorX*d)+"px";$canvasContainer.style.top=(g-b-originalCursorY*d)+"px";e.style.width=newWidth+"px";let height=$originalImg.height;let newHeight=height*zoomFactor;e.style.height=newHeight+"px";brushOutline_setSize(brushSize);brushOutline_canvas.style.left=a-brushSize*zoomFactor/2+"px";brushOutline_canvas.style.top=g-brushSize*zoomFactor/2+"px";document.getElementById("status--zoom").innerHTML=(zoomFactor*100).toFixed(0)+"%"}function changeZoom_old(d,b,a,f,e,c){let zoomMagnitude=0.1;let _factor=c||null;let _x=a||document.width/2;let _y=f||document.height/2;if(e===true){zoomFactor=1}else{if(b==="-"){zoomFactor-=zoomMagnitude}else{zoomFactor+=zoomMagnitude}if(zoomFactor<zoomMagnitude){zoomFactor=zoomMagnitude}if(zoomFactor>40){zoomFactor=40}}if(_factor!=null){zoomFactor=_factor}let scaledWidth=originalImageDimensions.width*zoomFactor;let scaledHeight=originalImageDimensions.height*zoomFactor;let deltaWidth=d.offsetWidth-scaledWidth;let deltaHeight=d.offsetHeight-scaledHeight;let deltaOffsetX=_x-_x*zoomMagnitude;let deltaOffsetY=_y-_y*zoomMagnitude;d.style.width=scaledWidth+"px";d.style.height=scaledHeight+"px";d.style.left=offset(d).left+deltaWidth*(deltaOffsetX/scaledWidth)+"px";d.style.top=offset(d).top+deltaHeight*(deltaOffsetY/scaledHeight)+"px";brushOutline_setSize(brushSize);brushOutline_canvas.style.left=_x-brushSize*zoomFactor/2+"px";brushOutline_canvas.style.top=_y-brushSize*zoomFactor/2+"px";document.getElementById("status--zoom").innerHTML=(zoomFactor*100).toFixed(0)+"%"};